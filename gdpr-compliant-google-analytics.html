<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Additional meta tags -->
    <meta name="description" content="Example on how to set-up Google Analytics to be compliant with EU General Data Protection Regulation (GDPR).">
    <meta name="author" content="Michal Z Gow">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://michalgow.github.io/gdpr-compliant-google-analytics" />
    <meta property="article:published_time" content="2019-05-12" />

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="css/bootstrap.min.css">

    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/custom.css">

    <!-- Favicons -->
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
    <meta name="msapplication-TileColor" content="#da532c">
    <meta name="theme-color" content="#ffffff">

    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&display=swap" rel="stylesheet"> 

    <!-- Title -->
    <title>Michal Z Gow | GDPR Compliant Google Analytics</title>

    <!-- Spamspan script -->
    <script src="js/spamspan.js"></script>
  </head>

  <body>

    <!-- Navigation -->
    <nav class="navbar navbar-light bg-light bg-transparent">
      <div class="container">
          <button class="navbar-toggler" data-target="#michalgow-nav" data-toggle="collapse" aria-label="Toggle menu block">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div id="michalgow-nav" class="collapse navbar-collapse">
            <ul class="navbar-nav mr-auto">
              <li class="nav-item"><a class="nav-link" href="/#aig">AIG Articles</a></li>
              <li class="nav-item"><a class="nav-link" href="/#general-articles">General Articles</a></li>
              <li class="nav-item"><a class="nav-link" href="/#most-recent-projects">Most Recent Projects</a></li>
              <li class="nav-item"><a class="nav-link" href="#michalgow-contacts">Contacts</a></li>
              <li class="nav-item"><a class="nav-link" href="#michalgow-legal">Legal</a></li>
            </ul>
          </div>
      </div>
    </nav>

    <!-- Header -->
    <div class="container-fluid mt-2" id="michalgow-header">
      <div class="container">
        <div class="row text-center">
          <div class="col">
            <a href="/">
              <img class="w-25" src="images/michal-gow-bg.png" alt="Michal Z Gow caricature">
            </a>
            <h1>Michal Z Gow - GDPR-compliant Google Analytics</h1>

            <strong>Last updated: 12 May 2019</strong>
            <hr class="w-lg-50 w-75">
            <p>Solutions architect, team lead, Drupal evangelist and AI enthusiast in Edinburgh, Scotland</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Terms of use -->
    <div class="container-fluid mt-5">
      <div class="container">
        <div class="row">
          <div class="col">

              <p class="abstract pt-4 pb-4 pl-0 pl-md-4">
                <strong>Abstract:</strong> The European legislation which regulates gathering and processing Personally 
                identifiable information (PII) has a direct effect on how web analytic services (tracking of website traffic) 
                must behave concerning EU citizen's data. The legislation requires the Data Controller (website owner) to obtain 
                consent from every website user before any PII is sent for processing, and/or before anything is stored at or 
                retrieved from the user’s device. There is an unceasing effort from the technology companies towards developing or 
                employing technologies which would allow them to continue to identify a user without asking him for 
                permission to do so. However, the legal opinion seems to be unshaken: Website owners must either ensure 
                no personal data is gathered and processed, or upfront lawfully obtain consent. Both strategies are perfectly 
                doable with Google Analytics (GA). 
              </p>

              <p>
                There are two main pieces of legislation governing usage of 3<sup>rd</sup> party data processors like GA: (1) 
                the <a href="https://www.legislation.gov.uk/uksi/2003/2426">Privacy and Electronic Communications Regulations (PECR)</a>; and
                (2) the <a href="https://gdpr-info.eu/">General Data Protection Regulation (GDPR)</a>. The first mainly defines 
                what constitutes as personal data, and the second gives a guidance under which conditions such data can be 
                gathered and processed.
              </p>

              <h3>Why Google Analytics in default setup requires user consent to be GDPR and PECR compliant</h3>

                <p>
                  In order to provide reliable analytics of the behaviour of an average user, GA needs to identify each single user. 
                  In its default setup GA aims to obtain as much personal data as possible on each user, such as their IP address, 
                  browser type, operating system, geography (etc.). Additionally, GA stores information on the user’s computer in 
                  form of a file called the 'cookie'. For this to be legal according to EU GDPR, the website owner needs consent 
                  from the user, obtained upfront and given actively. That means solutions such as a pre-ticked box or an opt-out 
                  offer are insufficient. The user must  <strong>active choose</strong> to allow their data to be gathered and 
                  processed by <strong>selecting from two options of the same size and visibility, or by selecting the box by 
                  themselves</strong>.
                </p>

                <h4>Non-compliant workarounds</h4>

                  <p>
                    Studies suggest that only around <a href="https://medium.com/dataseries/only-9-of-visitors-give-gdpr-consent-to-be-tracked-4d8c84ed16c0">9% of visitors</a>
                    are willing to give the consent to be tracked, which renders the statistic provided by GA unreliable. Several 
                    techniques have been suggested as a way around the necessity of obtaining the consent: (1) anonymizing the IP 
                    address, (2) replacing cookies with HTML5 LocalStorage, and (3) using browser fingerprinting instead of using 
                    storage at all. However, none of these techniques are compliant with the legislation.
                  </p>

                  <h5>Anonymized IP</h5>

                    <p>
                      This was actually not intended as a workaround on its own. But in order to be eventually compliant with EU 
                      regulations, Google had to offer a way to anonymize the IP whilst still offering high level of statistic 
                      accuracy. Why doesn't it work on its own? GA still gathers lots of private information and stores it locally 
                      on the user's computer. 
                    </p>

                  <h5>Replacing cookie with HTML5 LocalStorage</h5>

                    <p>
                      Before the introduction of the HTML5, cookie files were the only way to store information during a user's 
                      visit on the website (a user session). Because the web is stateless, storing some information locally in 
                      a user's browser is the only way how to accurately identify that the same browser was used to browse 
                      different pages of the same website. When the GDPR was introduced, requiring the web owners to inform their 
                      users about the gathering and processing PII, cookies were often mentioned as the biggest issue, and 
                      <a href="https://stackoverflow.com/questions/10668292/is-there-a-setting-on-google-analytics-to-suppress-use-of-cookies-for-users-who">some developers</a> 
                      suggested switching to LocalStorage offered by HTML5. The problem is, the PECR in regulation 6 states that 
                      "[...] person shall not [store or] gain access to information stored, in the terminal equipment of a subscriber 
                      or user unless [GDPR rules] are met." Cookies were mentioned simply because they were the only technology at 
                      the time which allowed for storing information in the "terminal equipment of a subscriber or user" - but 
                      <em>any</em> technology doing so must comply with regulations. There are GDPR-compliant situations when consent
                      is not required for using the browser local storage (or cookies), described in an  article by 
                      <a href="https://ico.org.uk/for-organisations/guide-to-pecr/guidance-on-the-use-of-cookies-and-similar-technologies/how-do-the-cookie-rules-relate-to-the-gdpr/#GDPR1">The UK's Information Commissioner</a>, 
                      but using the storage for tracing does require the user’s consent. 
                    </p>

                  <h5>Fingerprinting</h5>

                    <p>
                      Supporters of this technique suggest that replacing locally stored information by dynamic browser fingerprinting 
                      should be compliant with EU legislation. With fingerprinting no information is stored locally, instead every time 
                      a user visits the page he is identified by the metadata he shares (e.g. IP address, browser type, language settings). 
                      However, this by itself would still be illegal, as gaining access to information stored in the terminal equipment of a 
                      subscriber or user still requires active user consent according to the GDPR. More about this topic can be found 
                      <a href="https://www.eff.org/deeplinks/2018/06/gdpr-and-browser-fingerprinting-how-it-changes-game-sneakiest-web-trackers">here</a>.
                    </p>

            <h3>GDPR and PECR compliant Google Analytics without GDPR banner</h3>

              <p>
                There are four parts to being GDPR and PECR compliant without bothering the webpage users with a banner. The first 
                three parts are well described in an article by <a href="https://adzerk.com/blog/gdpr-google-analytics/">Chris Shuptrine</a>, 
                the fourth is shown below and concerns GA settings.
              </p>

                <ol>
                  <li>
                    <strong>Content control</strong> - If you have a dynamic website, you have to ensure no private information 
                    (e.g. user name, email) is sent back to Google. 
                  </li>
                  <li>
                    <strong>Set-up GA to be GDPR compliant</strong> - Ensure GA does not share the data you send to it. 
                  </li>
                  <li>
                    <strong>Privacy policy</strong> - Enable the users to check that there is no private data stored about them 
                    even though GA is on. 
                  </li>
                  <li>
                    <strong>GA setup</strong> - You need to ensure the GA code is not storing anything locally in the users’ 
                    browsers and that it does not gather IP address by itself. 
                  </li>
                </ol>


              <h4>GDPR compliant Google Analytics script setup without banner</h4>

              <figure>
                <pre>
                  <code contenteditable spellcheck="false">
&lt;script async src="https://www.googletagmanager.com/gtag/js?id=UA-XXXXXXXXX-X"&gt;&lt;/script&gt;
&lt;script&gt;
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-XXXXXXXXX-X', 
    {
      'anonymize_ip': true,
      'client_storage': 'none'
    }
  );
&lt;/script&gt;
                  </code>
                </pre>
              </figure>
          </div>
        </div>
      </div>
    </div>

    <!-- Contants & Legal -->
    <div class="container-fluid mt-4 mb-5">
      <div class="container">
        <div class="row text-left text-md-center">
          <div class="col-md-6">
            <h2 id="michalgow-contacts">Contacts</h2>
            <div class="mt-3">
              <span class="btn-link btn-link-email">
                <span class="spamspan">
                  <span class="u">michal.gow</span> [at] <span class="d">outlook [dot] com</span>
                </span>
              </span>
            </div>
          </div>
          <div class="col-md-6 mt-md-0 mt-4">
            <h2 id="michalgow-legal">Legal</h2>
            <ul class="list-unstyled">
              <li><a href="/privacy-policy">Privacy policy</a></li>
              <li><a href="/terms-of-use">Terms of use</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script
        src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
        crossorigin="anonymous">
    </script>
    <script 
        src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
        integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
        crossorigin="anonymous">
    </script>
    <script src="js/bootstrap.min.js"></script>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-154655364-2"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-154655364-2', {'anonymize_ip': true, 'client_storage': 'none'});
    </script>
  </body>
</html>
